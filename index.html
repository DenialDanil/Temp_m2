<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Temp_stat – вся історія</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>body{background:#000;color:#0f0;font-family:Arial;text-align:center;}</style>
</head>
<body>
  <h1>Temp_stat — дані зберігаються назавжди</h1>
  <div id="chart" style="width:95%;height:80vh;margin:auto;"></div>

<script>
<script>
  const URL = "https://temp-stat2.onrender.com/data";  // твоя адреса

  let tempData = [];
  let humData = [];
  let timeData = [];

  Plotly.newPlot('chart', [
    { x: [], y: [], name: 'Температура °C', line: {color: '#f44'} },
    { x: [], y: [], name: 'Вологість %', yaxis: 'y2', line: {color: '#44f'} }
  ], {
    title: 'Temp_stat — живі дані',
    yaxis: {title: '°C'}, yaxis2: {title: '%', overlaying: 'y', side: 'right'},
    paper_bgcolor: '#000', plot_bgcolor: '#111', font: {color: '#0f0'}
  });

  setInterval(async () => {
    try {
      const res = await fetch(URL + "?t=" + Date.now());  // обход кешу
      const d = await res.json();

      const now = new Date().toLocaleTimeString();

      tempData.push(d.temp);
      humData.push(d.hum);
      timeData.push(now);

      // обмежуємо 100 точок
      if (tempData.length > 100) {
        tempData.shift(); humData.shift(); timeData.shift();
      }

      Plotly.react('chart', [
        { x: timeData, y: tempData, name: 'Температура °C' },
        { x: timeData, y: humData, name: 'Вологість %', yaxis: 'y2' }
      ], {
        title: `Останнє: ${d.temp}°C | ${d.hum}% | ${now}`,
        yaxis: {title: true}, yaxis2: {overlaying: 'y', side: 'right'}
      });

    } catch (e) {
      console.log("Помилка:", e);
    }
  }, 8000);
</script>
</body>
</html>
